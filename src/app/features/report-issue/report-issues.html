@if (isAdmin()) {
<div class="admin-section">
  <div class="admin-header">
    <h2>All Reported Issues</h2>
    <p class="subtitle">View and manage all user-reported issues</p>
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Issue Type</th>
          <th>Description</th>
          <th>Date Reported</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        @for (issue of allIssues(); track issue.id) {
        <tr>
          <td class="type-cell">
            <span class="issue-type-badge">{{ issue.issueType }}</span>
          </td>
          <td class="message-cell">{{ issue.issueMessage }}</td>
          <td class="date-cell">{{ issue.date | date : 'medium' }}</td>
          <td class="status-cell">
            @if (issue.completed) {
            <div class="status-content">
              <span class="status-badge completed">
                <span class="completed-icon">✓</span>
                Completed
              </span>
              <span class="completed-date">{{ issue.completed | date : 'short' }}</span>
            </div>
            } @else {
            <div class="status-content">
              <span class="status-badge pending">Pending</span>
              <span class="mark-completed-link" (click)="completeIssue(issue.id)">
                Mark as completed
              </span>
            </div>
            }
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
}

<div class="report-container">
  <div class="header-section">
    <h2>Report an Issue</h2>
    <p class="subtitle">Help us improve by reporting any issues you encounter</p>
  </div>

  <form (ngSubmit)="submitIssue()" #issueForm="ngForm">
    <div class="form-group">
      <label for="issueType">Issue Type <span class="required">*</span></label>
      <div class="select-wrapper">
        <select
          id="issueType"
          name="issueType"
          [(ngModel)]="issueType"
          required
          class="form-select"
        >
          <option value="" disabled selected>Select an issue type</option>
          <option value="missed pickup">Missed Pickup</option>
          <option value="bug">Bug/Technical Issue</option>
          <option value="other">Other</option>
        </select>
        <div class="select-icon">
          <svg
            width="12"
            height="8"
            viewBox="0 0 12 8"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M1 1L6 6L11 1"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="issueMessage">Issue Description <span class="required">*</span></label>
      <textarea
        id="issueMessage"
        name="issueMessage"
        [(ngModel)]="issueMessage"
        placeholder="Please provide detailed information about the issue..."
        required
        minlength="4"
        class="form-textarea"
      ></textarea>
      <div class="char-count">{{ issueMessage.length }} characters</div>
    </div>

    <button class="btn-primary" type="submit" [disabled]="!issueForm.valid || isSubmitting">
      @if (isSubmitting) {
      <span class="spinner"></span>
      Submitting... } @else { Submit Issue }
    </button>
  </form>

  @if (submitted) {
  <div class="success-message">
    <div class="success-icon">✓</div>
    <div class="success-content">
      <h3>Issue Reported Successfully!</h3>
      <p>Thank you for your report. We'll look into this as soon as possible.</p>
    </div>
  </div>
  } @if (errorMessage) {
  <div class="error-message">
    <div class="error-icon">⚠</div>
    <div class="error-content">
      <h3>Submission Failed</h3>
      <p>{{ errorMessage }}</p>
    </div>
  </div>
  }
</div>
